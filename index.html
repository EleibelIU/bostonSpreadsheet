<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airbnb Listings</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/hack-font/3.3.0/web/hack.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <!-- Replace YOUR_API_KEY with an actual Google Maps API key -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
    <style>
        /* Previous styles remain the same until the map-related additions */
        
        /* ... (previous styles) ... */

        .map-container {
            background-color: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 1px solid var(--muted);
            height: 400px;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
            border-radius: 4px;
        }

        .map-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--card-bg);
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--muted);
            z-index: 1;
            color: var(--secondary);
            font-size: 0.8rem;
        }

        .listing-card.active {
            border-color: var(--highlight);
            transform: translateY(-4px);
        }

        .location-button {
            background: none;
            border: none;
            color: var(--highlight);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-family: Hack, monospace;
            font-size: 0.9rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .location-button:hover {
            background-color: var(--muted);
        }

        /* ... (rest of previous styles) ... */
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>> DrakkenhomieFinder_v1.0</h1>
            <p>// Available properties near The Palladium</p>
        </header>

        <div class="map-container">
            <div class="map-overlay">Click location names to highlight on map</div>
            <div id="map"></div>
        </div>

        <!-- Rest of the HTML structure remains the same -->
        <!-- ... -->
    </div>

    <script>
        let map;
        let markers = [];
        let bounds;
        const VENUE_LOCATION = { lat: 42.2626, lng: -71.8023 }; // The Palladium, Worcester coordinates

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 10,
                center: VENUE_LOCATION,
                styles: [
                    {
                        "elementType": "geometry",
                        "stylers": [{"color": "#272822"}]
                    },
                    {
                        "elementType": "labels.text.stroke",
                        "stylers": [{"color": "#242424"}]
                    },
                    {
                        "elementType": "labels.text.fill",
                        "stylers": [{"color": "#746855"}]
                    },
                    {
                        "featureType": "administrative.locality",
                        "elementType": "labels.text.fill",
                        "stylers": [{"color": "#66D9EF"}]
                    },
                    // Add more custom styles as needed
                ],
            });

            // Add venue marker
            new google.maps.Marker({
                position: VENUE_LOCATION,
                map: map,
                title: "The Palladium",
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 10,
                    fillColor: "#F92672",
                    fillOpacity: 1,
                    strokeWeight: 2,
                    strokeColor: "#ffffff",
                }
            });

            bounds = new google.maps.LatLngBounds();
            bounds.extend(VENUE_LOCATION);
        }

        function geocodeLocation(location, name, viability) {
            if (!location) return;
            
            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({ 
                address: `${location}, MA` 
            }, (results, status) => {
                if (status === 'OK') {
                    const position = results[0].geometry.location;
                    const marker = new google.maps.Marker({
                        map: map,
                        position: position,
                        title: name,
                        icon: {
                            path: google.maps.SymbolPath.CIRCLE,
                            scale: 8,
                            fillColor: viability >= 4 ? "#A6E22E" : "#FD971F",
                            fillOpacity: 0.8,
                            strokeWeight: 1,
                            strokeColor: "#ffffff",
                        }
                    });

                    const infoWindow = new google.maps.InfoWindow({
                        content: `<div style="color: #272822;"><strong>${name}</strong><br>${location}, MA</div>`
                    });

                    marker.addListener('click', () => {
                        infoWindow.open(map, marker);
                    });

                    markers.push({ marker, name });
                    bounds.extend(position);
                    map.fitBounds(bounds);
                }
            });
        }

        function highlightMarker(name) {
            markers.forEach(({ marker, name: markerName }) => {
                if (markerName === name) {
                    marker.setAnimation(google.maps.Animation.BOUNCE);
                    setTimeout(() => marker.setAnimation(null), 2100);
                    map.panTo(marker.getPosition());
                }
            });
        }

        function formatMoney(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount);
        }

        function getViabilityBadge(viability) {
            const className = viability >= 4 ? 'badge-success' : 'badge-warning';
            return `<span class="badge ${className}" data-tooltip="Property Rating: ${viability} out of 5">${viability}/5</span>`;
        }

        function createListingCard(listing) {
            const locationDisplay = listing.Location ? 
                `<button class="location-button" onclick="highlightMarker('${listing["Name "]}')">
                    üìç ${listing.Location}
                </button>` : 
                'Location N/A';

            return `
                <article class="listing-card">
                    <div class="listing-content">
                        <h2 class="listing-title">${listing["Name "]}</h2>
                        
                        <div class="listing-location">
                            ${locationDisplay}
                        </div>

                        <!-- Rest of the card template remains the same -->
                        ...
                    </div>
                </article>
            `;
        }

        document.addEventListener("DOMContentLoaded", async function () {
            try {
                initMap();
                const response = await fetch('Drakkenhomies_Boston_AirBNB.json');
                const data = await response.json();
                
                const container = document.getElementById('listings-container');
                const sortedData = _.sortBy(data, listing => -listing.Viability);
                
                container.innerHTML = sortedData
                    .map(listing => createListingCard(listing))
                    .join('');

                // Add markers for each location
                sortedData.forEach(listing => {
                    if (listing.Location) {
                        geocodeLocation(listing.Location, listing["Name "], listing.Viability);
                    }
                });
            } catch (error) {
                console.error('Error loading listings:', error);
            }
        });
    </script>
</body>
</html>